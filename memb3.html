<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auracast Health Hub (Standalone HTML)</title>
    <!-- REMOVED: Tailwind CSS CDN and config -->
    
    <!-- Load React, ReactDOM, and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <style>
        /* Define the Inter font family */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* bg-gray-100 */
            margin: 0;
            padding: 0;
        }
        
        /* Utility Classes */
        .antialiased {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .flex { display: flex; }
        .justify-center { justify-content: center; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-between { justify-content: space-between; }
        .flex-grow { flex-grow: 1; }
        .flex-shrink-0 { flex-shrink-0; }

        /* Layout */
        .min-h-screen { min-height: 100vh; }
        .app-container {
            padding: 1rem; /* p-4 */
        }
        @media (min-width: 640px) { /* sm: */
            .app-container { padding: 1.5rem; } /* sm:p-6 */
        }
        @media (min-width: 1024px) { /* lg: */
            .app-container { padding: 2rem; } /* lg:p-8 */
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem; /* gap-6 */
        }
        @media (min-width: 1024px) { /* lg: */
            .main-grid { grid-template-columns: repeat(3, 1fr); }
            .lg-col-span-2 { grid-column: span 2 / span 2; }
        }

        /* Header */
        .header-main {
            margin-bottom: 2rem; /* mb-8 */
            padding: 1rem; /* p-4 */
            background-color: white; /* bg-white */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            border-radius: 0.75rem; /* rounded-xl */
            position: sticky;
            top: 1rem;
            z-index: 10; /* z-10 */
        }
        .header-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #1e3a8a; /* text-indigo-800 */
        }
        @media (min-width: 640px) { /* sm: */
            .header-title { font-size: 1.875rem; } /* sm:text-3xl */
        }
        .header-icon {
            width: 1.75rem; height: 1.75rem; /* w-7 h-7 */
            margin-right: 0.5rem; /* mr-2 */
            color: #4f46e5; /* text-indigo-600 */
        }
        .header-user-id {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
        }
        .header-user-id span {
            margin-left: 0.25rem; /* ml-1 */
            font-family: monospace; /* font-mono */
            font-size: 0.75rem; /* text-xs */
            color: #4f46e5; /* text-indigo-600 */
            word-break: break-all; /* break-all */
        }

        /* Card Base */
        .card-base {
            background-color: white; /* bg-white */
            padding: 1.5rem; /* p-6 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); /* shadow-lg */
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .card-tracker {
            border-top: 4px solid #10b981; /* border-t-4 border-emerald-500 */
        }
        .card-analytics {
            border-top: 4px solid #9333ea; /* border-t-4 border-purple-500 */
        }

        /* Form/Input */
        .form-section {
            margin-bottom: 1rem; /* space-y-4 */
        }
        .form-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #374151; /* text-gray-700 */
            margin-bottom: 0.25rem; /* mb-1 */
        }
        .input-field {
            width: 100%;
            padding: 0.75rem; /* p-3 */
            border: 1px solid #d1d5db; /* border border-gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            transition: border-color 0.15s, box-shadow 0.15s; /* transition duration-150 */
            background-color: white;
            resize: none;
        }
        .input-field:focus {
            border-color: #10b981; /* focus:border-emerald-500 */
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2); /* focus:ring-emerald-500 (approx) */
            outline: none;
        }
        
        .grid-cols-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem; /* gap-4 */
        }

        /* Button */
        .btn-primary {
            width: 100%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1rem; /* px-4 py-3 */
            border: 1px solid transparent;
            font-size: 1rem; /* text-base */
            font-weight: 500; /* font-medium */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* shadow-md */
            color: white;
            background-color: #059669; /* bg-emerald-600 */
            transition: background-color 0.15s, opacity 0.15s;
        }
        .btn-primary:hover {
            background-color: #047857; /* hover:bg-emerald-700 */
        }
        .btn-primary:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.5); /* focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 */
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* History List */
        .history-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 24rem; /* max-h-96 */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem; /* space-y-3 */
        }
        .history-item {
            padding: 1rem; /* p-4 */
            background-color: #f9fafb; /* bg-gray-50 */
            border-radius: 0.75rem; /* rounded-xl */
            border: 1px solid #e5e7eb; /* border border-gray-200 */
            transition: box-shadow 0.15s;
        }
        .history-item:hover {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* hover:shadow-sm */
        }
        .history-header {
            font-size: 0.875rem; /* text-sm */
            margin-bottom: 0.25rem; /* mb-1 */
        }
        .history-type {
            font-weight: 700; /* font-bold */
            color: #1f2937; /* text-gray-800 */
        }
        .history-severity {
            margin-left: 0.5rem; /* ml-2 */
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* font-semibold */
            color: #dc2626; /* text-red-600 */
            padding: 0.25rem 0.5rem; /* p-1 px-2 */
            background-color: #fee2e2; /* bg-red-100 */
            border-radius: 9999px; /* rounded-full */
        }
        .history-context {
            font-size: 0.75rem; /* text-xs */
            color: #4f46e5; /* text-indigo-600 */
            margin-top: 0.5rem; /* mt-2 */
            padding: 0.5rem; /* p-2 */
            background-color: #eef2ff; /* bg-indigo-50 */
            border-radius: 0.5rem; /* rounded-lg */
        }
        
        /* Environmental Status Card */
        .status-card-base {
            padding: 1rem; /* p-4 */
            border-radius: 0.75rem; /* rounded-xl */
            font-size: 0.875rem; /* text-sm */
            transition: all 0.3s;
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .status-card-header {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: white;
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .status-card-text {
            color: white;
            font-size: 0.75rem; /* text-xs */
            opacity: 0.9;
        }
        .status-yellow {
            background-color: #f59e0b; /* bg-yellow-500 */
        }

        /* Analytics Box */
        .analytics-insight {
            padding: 1rem; /* p-4 */
            background-color: #f3e8ff; /* bg-purple-50 */
            border-left: 4px solid #a855f7; /* border-l-4 border-purple-400 */
            border-radius: 0.5rem; /* rounded-lg */
            margin-bottom: 1rem; /* mb-4 */
        }
        .analytics-title {
            font-weight: 600; /* font-semibold */
            color: #6d28d9; /* text-purple-700 */
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .analytics-text {
            font-size: 0.875rem; /* text-sm */
            color: #7c3aed; /* text-purple-600 */
        }
        .analytics-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.25rem; /* space-y-1 */
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* text-gray-600 */
            padding: 0.75rem; /* p-3 */
            background-color: #f9fafb; /* bg-gray-50 */
            border-radius: 0.5rem; /* rounded-lg */
        }
        .analytics-list li strong {
            font-weight: 600; /* font-semibold */
        }

        /* Disclaimer */
        .disclaimer {
            margin-top: 1.5rem; /* mt-6 */
            padding: 0.75rem; /* p-3 */
            background-color: #fee2e2; /* bg-red-100 */
            border-left: 4px solid #ef4444; /* border-l-4 border-red-500 */
            border-radius: 0.5rem; /* rounded-lg */
        }
        .disclaimer-title {
            font-weight: 700; /* font-bold */
            font-size: 0.75rem; /* text-xs */
            color: #b91c1c; /* text-red-700 */
        }
        .disclaimer-text {
            font-size: 0.75rem; /* text-xs */
            color: #dc2626; /* text-red-600 */
            margin-top: 0.25rem; /* mt-1 */
        }

        /* Alert Component */
        .health-alert {
            position: fixed;
            top: 1rem; /* top-4 */
            left: 50%;
            transform: translateX(-50%); /* transform -translate-x-1/2 */
            z-index: 50; /* z-50 */
            padding: 1rem; /* p-4 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.25), 0 10px 10px -5px rgba(0, 0, 0, 0.1); /* shadow-2xl */
            transition: all 0.5s; /* transition-all duration-500 */
            width: 91.666667%; /* w-11/12 */
            max-width: 32rem; /* md:max-w-lg (approx) */
            color: white;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem; /* space-x-3 */
        }

        .health-alert .icon-lg { width: 1.5rem; height: 1.5rem; margin-top: 0.125rem;} /* w-6 h-6 mt-0.5 */
        .health-alert .title { font-weight: 700; text-transform: uppercase; font-size: 0.875rem; } /* font-bold uppercase text-sm */
        .health-alert .care-badge {
            font-size: 0.75rem; /* text-xs */
            font-weight: 600; /* font-semibold */
            margin-top: 0.125rem; /* mt-0.5 */
            padding: 0.125rem 0.5rem; /* px-2 py-0.5 */
            display: inline-block;
            border-radius: 9999px;
            background: white;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .health-alert .text-detail {
            font-size: 0.875rem; /* text-sm */
            margin-top: 0.25rem; /* mt-1 */
        }
        .health-alert button {
            padding: 0.25rem; /* p-1 */
            border-radius: 9999px;
            transition: background-color 0.15s;
        }
        .health-alert button:hover {
            background-color: rgba(255, 255, 255, 0.2); /* hover:bg-white/20 */
        }
        .health-alert button svg { width: 1rem; height: 1rem; } /* w-4 h-4 */


        /* Alert Color Schemes */
        .alert-success { background-color: #059669; border-bottom: 4px solid #065f46; } /* bg-green-600 border-green-800 */
        .alert-warning { background-color: #d97706; border-bottom: 4px solid #b45309; } /* bg-yellow-600 border-yellow-800 */
        .alert-moderate { background-color: #f97316; border-bottom: 4px solid #ea580c; } /* bg-orange-500 border-orange-700 */
        .alert-error { background-color: #dc2626; border-bottom: 4px solid #991b1b; } /* bg-red-600 border-red-800 */
        .alert-danger { background-color: #b91c1c; border-bottom: 4px solid #7f1d1d; } /* bg-red-700 border-red-900 */
        .alert-info { background-color: #2563eb; border-bottom: 4px solid #1e40af; } /* bg-blue-600 border-blue-800 */

        /* Loading Spinner */
        .loading-container {
            background-color: #f9fafb; /* bg-gray-50 */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .loader-icon {
            width: 2rem; height: 2rem; /* w-8 h-8 */
            animation: spin 1s linear infinite; /* animate-spin */
            color: #4f46e5; /* text-indigo-600 */
        }
        .loader-text {
            margin-left: 0.75rem; /* ml-3 */
            color: #4f46e5; /* text-indigo-600 */
            font-weight: 500; /* font-medium */
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* About Section Styles */
        .about-section {
            padding: 1.5rem; /* p-6 */
            margin-top: 2rem; /* mt-8 */
            background-color: #fff; /* bg-white */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            border-top: 4px solid #4f46e5; /* border-t-4 border-indigo-600 */
        }
        .about-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #1e3a8a; /* text-indigo-800 */
            margin-bottom: 0.75rem; /* mb-3 */
        }
        .about-description {
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* text-gray-600 */
            line-height: 1.5; /* leading-relaxed */
        }
        .about-description strong {
            color: #1f2937; /* text-gray-800 */
        }
    </style>
</head>
<body class="antialiased">

    <!-- Root container for the React app -->
    <div id="root"></div>

    <script type="text/babel">
        // Destructure necessary React hooks for cleaner code
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Icon Replacements (Using Emojis for standalone simplicity) ---
        const Icon = {
            // Updated to reflect the custom font size/style needed without Tailwind
            HeartPulse: ({ className }) => <span className={`text-xl ${className || ''}`} style={{ fontSize: '1.25rem' }}>❤️</span>,
            AirVent: ({ className }) => <span className={`text-xl ${className || ''}`} style={{ fontSize: '1.25rem' }}>💨</span>,
            User: ({ className }) => <span className={`text-base ${className || ''}`} style={{ fontSize: '1rem' }}>👤</span>,
            Loader2: ({ className }) => <span className={`loader-icon ${className || ''}`}>🔄</span>,
            AlertTriangle: ({ className }) => <span className={`text-xl ${className || ''}`} style={{ fontSize: '1.25rem' }}>⚠️</span>,
            CheckCircle: ({ className }) => <span className={`text-xl ${className || ''}`} style={{ fontSize: '1.25rem' }}>✅</span>,
            X: ({ className }) => <span className={`text-xl ${className || ''}`} style={{ fontSize: '1.25rem' }}>❌</span>,
            BarChart3: ({ className }) => <span className={`text-xl ${className || ''}`} style={{ fontSize: '1.25rem' }}>📊</span>,
        };
        const { HeartPulse, AirVent, User, Loader2, AlertTriangle, CheckCircle, X, BarChart3 } = Icon;


        // --- Local Data Hook (Uses browser's localStorage for persistence) ---

        const useLocalData = () => {
            const [userId] = useState("local-user-" + Math.random().toString(36).substring(2, 9));
            const [isAuthReady] = useState(true);

            // Initialize symptoms from localStorage if available
            const [symptoms, setSymptoms] = useState(() => {
                try {
                    const saved = localStorage.getItem('auracastSymptoms');
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.error("Could not load symptoms from localStorage:", e);
                    return [];
                }
            });

            // Save symptoms to localStorage whenever the state changes
            useEffect(() => {
                try {
                    localStorage.setItem('auracastSymptoms', JSON.stringify(symptoms));
                } catch (e) {
                    console.error("Could not save symptoms to localStorage:", e);
                }
            }, [symptoms]);

            return { userId, isAuthReady, symptoms, setSymptoms };
        };


        // --- Static Data & Helper Functions ---

        const SYMPTOM_OPTIONS = [
          'Cough', 'Shortness of breath', 'Wheezing', 'Chest tightness',
          'Sneezing', 'Itchy eyes', 'Runny nose', 'Rashes', 'Headache', 'Fatigue', 'Other'
        ];
        
        // Static Mock Data for a single location (reverted to fixed context)
        const STATIC_HEALTH_STATUS = {
            location: "Koovappally, Kerala, India", // Explicitly added the location
            aqiValue: 85,
            aqiText: "Moderate",
            primaryPollutant: "Ozone (O₃)",
            healthRisk: "Sensitive groups should reduce outdoor activity.",
            colorClass: 'status-yellow', // New class name
            pollutants: {
              'PM2.5': 28, // µg/m³
              'PM10': 55, // µg/m³
              'O3': 0.08, // ppm
              'NO2': 0.03, // ppm
              'CO': 3.1, // ppm
              'SO2': 0.005, // ppm
            },
            weather: {
              temp: '22°C',
              humidity: '65%',
              wind: '5 mph NW',
              pollenIndex: 'High',
            }
        };

        /**
         * Checks if the duration string contains a recognizable time unit or descriptive phrase.
         * UPDATED to include 'sec' and 'second'.
         */
        const isValidDurationFormat = (duration) => {
            if (!duration || duration.trim() === '') return false;
            const descriptiveUnits = /(sec|second|min|hour|hr|day|week|all day|intermittent|since)/i;
            return descriptiveUnits.test(duration.trim());
        };


        /**
         * Generates a simulated insight based on the entire symptom history (cumulative analysis).
         */
        const getSmartInsight = (symptoms, currentAQI) => {
            if (symptoms.length === 0) {
                return "Start logging your symptoms now to get immediate analysis linking your health to the current air quality and pollen levels.";
            }

            const latestSymptom = symptoms[0];
            
            // --- Logic for a Single Symptom Entry (Initial Insight) ---
            if (symptoms.length === 1) {
                const { type, severity } = latestSymptom;
                const { pollutants, aqiText, weather } = currentAQI;

                let insight = `**First Entry Insight (Severity ${severity}):** You logged a **${type}** symptom during ${aqiText} air quality.`;

                if (['Cough', 'Wheezing', 'Shortness of breath', 'Chest tightness'].includes(type) && pollutants['PM2.5'] > 25) {
                    insight += ` High levels of **PM2.5 (${pollutants['PM2.5']} µg/m³)** are a possible trigger. Limit strenuous outdoor activity.`;
                } else if (['Sneezing', 'Itchy eyes', 'Runny nose'].includes(type) && weather.pollenIndex === 'High') {
                    insight += ` The **High Pollen Index** is the most probable trigger. Consider an antihistamine or eye drops.`;
                } else if (severity >= 4) {
                    insight += ` With a severity of **${severity}**, please take immediate steps to reduce your exposure.`;
                } else {
                    insight += ` Symptom noted. This initial data point is logged with the environment. Continue tracking to identify patterns.`;
                }
                return insight;
            }

            // --- Logic for Multiple Symptoms (Cumulative Analysis) ---
            
            const totalEntries = symptoms.length;
            let totalSeverity = 0;
            const symptomCounts = {};
            let highSeverityCount = 0;
            let highAqiTriggerCount = 0;
            let pollenTriggerCount = 0;

            for (const symptom of symptoms) {
                totalSeverity += symptom.severity;
                symptomCounts[symptom.type] = (symptomCounts[symptom.type] || 0) + 1;
                
                if (symptom.severity >= 4) {
                    highSeverityCount++;
                }

                // Check for correlation on the day the symptom was logged
                if (symptom.exposureData.aqiValue > 70) { // Moderate or worse AQI
                    highAqiTriggerCount++;
                }
                
                // Simplified: Checking for high pollen correlation on the day the symptom was logged
                if (['Sneezing', 'Itchy eyes', 'Runny nose'].includes(symptom.type) && symptom.exposureData.weather.pollenIndex === 'High') {
                     pollenTriggerCount++;
                }
            }

            const averageSeverity = (totalSeverity / totalEntries).toFixed(1);
            
            // Find the most common symptom
            const mostCommonSymptom = Object.entries(symptomCounts).sort((a, b) => b[1] - a[1])[0];
            const commonSymptomType = mostCommonSymptom[0];
            const commonSymptomCount = mostCommonSymptom[1];

            let insight = `**Cumulative Analysis (Total Logs: ${totalEntries}):** `;

            // 1. Summary Insight
            insight += `Your dominant concern is **${commonSymptomType}** (${commonSymptomCount} logs), with an overall average severity of **${averageSeverity}** out of 5. `;

            // 2. Trend Insight
            if (highSeverityCount > 0.3 * totalEntries) {
                insight += ` You've reported **${highSeverityCount} high-severity episodes**. This suggests you have acute flare-ups that require close monitoring. `;
            } else if (averageSeverity < 2.5) {
                insight += ` Your recent history shows mostly **mild symptoms**, indicating effective management or generally favorable conditions. `;
            }

            // 3. Environmental Correlation Insight
            if (highAqiTriggerCount > 0.5 * totalEntries) {
                insight += ` **Strong Air Quality Link:** Over half (${highAqiTriggerCount} of ${totalEntries}) of your logs occurred when the AQI was moderate or worse. **Managing indoor air quality is your top priority.**`;
            } else if (pollenTriggerCount > 0) {
                // If the most common symptom is allergy related and there's a pollen trigger count
                 insight += ` **Seasonal Trigger Detected:** ${pollenTriggerCount} of your allergy-type symptoms are linked to high pollen days. Prepare for peak pollen seasons.`;
            } else {
                insight += ` We're currently building a more precise correlation model. Please continue logging details (notes) to help us refine the pattern.`;
            }

            return insight;
        };


        // --- App Component ---

        const App = () => {
          const { userId, isAuthReady, symptoms, setSymptoms } = useLocalData();

          const [newSymptomData, setNewSymptomData] = useState({
            type: 'Cough',
            severity: 3,
            duration: '',
            notes: '',
            // New state for specific symptom when 'Other' is selected
            otherSymptom: '', 
          });
          const [alertMessage, setAlertMessage] = useState(null);

          // Simulated Environmental Context is now static
          const healthStatus = useMemo(() => ({
            ...STATIC_HEALTH_STATUS,
            icon: <AlertTriangle className="icon-lg" /> // Mock icon
          }), []);

          // Update symptom data from form inputs
          const handleSymptomChange = (e) => {
            const { name, value } = e.target;
            
            // Use local update object
            let update = {
                [name]: name === 'severity' 
                    ? (value === '' ? '' : parseInt(value))
                    : value
            };

            // If the user selects a new type, and it's not 'Other', clear the specific 'otherSymptom' field.
            if (name === 'type' && value !== 'Other') {
                update.otherSymptom = '';
            }

            setNewSymptomData(prev => ({
              ...prev,
              ...update,
            }));
          };
          

          // Symptom Tracker Logic
          const addSymptom = useCallback(async (e) => {
            e.preventDefault();
            
            const severityNum = newSymptomData.severity === '' ? NaN : parseInt(newSymptomData.severity);
            
            // Determine the actual symptom type for logging and validation
            const symptomToLog = newSymptomData.type === 'Other' 
                ? newSymptomData.otherSymptom.trim() 
                : newSymptomData.type;

            // 1. Basic Mandatory Field Check (Type, Severity, Duration presence, including specific symptom name)
            if (
                !symptomToLog || // Check if the final symptom name is present (handles empty "Other" input)
                isNaN(severityNum) || 
                severityNum < 1 || 
                severityNum > 5 || 
                !newSymptomData.duration.trim()
            ) {
                // Customized message for the "Other" case if the specific symptom is missing
                const missingDetail = newSymptomData.type === 'Other' && !newSymptomData.otherSymptom.trim()
                    ? 'the specific Symptom Name'
                    : 'Symptom Type';

                setAlertMessage({ 
                    type: 'error', 
                    text: `Please fill in ${missingDetail}, Severity (1-5), and a descriptive Duration.` 
                });
                return;
            }

            // 2. Duration Format Check (Checking for unit specificity)
            if (!isValidDurationFormat(newSymptomData.duration)) {
                setAlertMessage({
                    type: 'error',
                    text: 'Duration requires a specific unit (e.g., "30 seconds", "10 mins", "2 hours", "4 days") or descriptive phrase like "All day". Please correct.'
                });
                return;
            }
            // ---------------------------------

            const { colorClass, icon, ...serializableHealthStatus } = healthStatus; 
            
            const newEntry = {
                id: Date.now().toString(),
                // LOG THE CORRECT SYMPTOM: use the 'otherSymptom' if 'Other' was selected, otherwise use 'type'
                type: symptomToLog, 
                severity: severityNum,
                duration: newSymptomData.duration, 
                notes: newSymptomData.notes, 
                exposureData: serializableHealthStatus,
                timestamp: new Date().toLocaleString()
            };
            
            try {
              // Add new symptom to the start of the list and cap history at 20 entries
              setSymptoms(prev => [newEntry, ...prev].slice(0, 20)); 
              
              // Reset form fields
              setNewSymptomData(prev => ({
                type: prev.type,
                severity: 3,
                duration: '',
                notes: '',
                // Clear 'otherSymptom' if 'Other' was selected, otherwise keep it cleared
                otherSymptom: prev.type === 'Other' ? '' : prev.otherSymptom, 
              }));
              
              let alertType = 'success';
              let alertText = `Symptom "${symptomToLog}" logged successfully and linked to environmental data.`;

              if (severityNum >= 4) {
                alertType = 'danger'; // Critical severity alert type (4-5)
                alertText = `⚠ High Severity Alert (Level ${severityNum} of 5)! Please reduce strenuous outdoor activity and monitor your condition closely.`;
              } else if (severityNum === 3) {
                alertType = 'moderate'; // Moderate alert type (3)
                alertText = `Symptom logged at Moderate Severity (Level 3 of 5). Pay attention to any environmental changes and check the analytics dashboard.`;
              }
              
              setAlertMessage({ type: alertType, text: alertText });

            } catch (error) {
              console.error("Error adding symptom locally:", error);
              setAlertMessage({ type: 'error', text: 'Failed to log symptom locally.' });
            }
          }, [newSymptomData, healthStatus, setSymptoms]);


          // Personalized Health Alerts (Simulated Push Notification UI)
          useEffect(() => {
            // Only set a default alert if no user-generated alert is active
            if (!alertMessage || alertMessage.type === 'info' || alertMessage.type === 'warning') {
                let currentAlertType = 'info';
                let currentAlertText = 'Air quality is good. Enjoy your day outside!';

                if (healthStatus.aqiValue > 100) {
                    currentAlertType = 'danger';
                    currentAlertText = `Critical Air Quality Alert: AQI is ${healthStatus.aqiValue}! ${healthStatus.healthRisk}`;
                } else if (healthStatus.aqiValue > 75) {
                    currentAlertType = 'warning';
                    currentAlertText = `Air Quality Alert: AQI is ${healthStatus.aqiValue}. ${healthStatus.healthRisk}`;
                }
                
                // Only override if the new message is higher severity or the current message is a stale info/warning
                if (!alertMessage || alertMessage.type === 'info' || alertMessage.type === 'warning' || currentAlertType !== 'info') {
                    setAlertMessage({ type: currentAlertType, text: currentAlertText });
                }
            }
            
            const timer = setTimeout(() => setAlertMessage(null), 8000);
            return () => clearTimeout(timer);
          }, [healthStatus]); // eslint-disable-line react-hooks/exhaustive-deps


          // Custom Alert Component
          const HealthAlert = ({ message, onClose }) => {
            if (!message) return null;
            const { type, text } = message;

            let styleClasses = "";
            let IconComponent = CheckCircle;
            let title = "Health Alert";
            let careLevel = "General Monitoring"; // Default Care Level
            
            // Determine styles, title, and care level based on alert type
            switch (type) {
              case 'success':
                styleClasses = "alert-success";
                IconComponent = CheckCircle;
                title = "Log Success";
                careLevel = "Mild Symptom Logged";
                break;
              case 'warning':
                styleClasses = "alert-warning";
                IconComponent = AlertTriangle;
                title = "Environmental Warning";
                careLevel = "Increased Vigilance";
                break;
              case 'moderate': 
                styleClasses = "alert-moderate"; 
                IconComponent = AlertTriangle;
                title = "Moderate Symptom Alert";
                careLevel = "Self-Monitoring Recommended";
                break;
              case 'error':
                styleClasses = "alert-error";
                IconComponent = X;
                title = "Input Error";
                careLevel = "Input Correction Required";
                break;
              case 'danger': 
                styleClasses = "alert-danger"; 
                IconComponent = AlertTriangle;
                title = "Critical Health Alert"; 
                careLevel = "Urgent Attention Advised"; // Highest care level
                break;
              case 'info':
              default:
                styleClasses = "alert-info";
                IconComponent = HeartPulse;
                title = "Environmental Info";
                careLevel = "Good Conditions";
                break;
            }

            return (
              <div className={`health-alert ${styleClasses}`}>
                <IconComponent className="icon-lg" />
                <div className='flex-grow'>
                  {/* Main Title */}
                  <p className="title">{title}</p>
                  
                  {/* Care Level Badge */}
                  <p className="care-badge">{careLevel}</p>
                  
                  {/* Detailed Alert Text */}
                  <p className="text-detail">{text}</p>
                </div>
                <button onClick={onClose}>
                    <X className='w-4 h-4'/>
                </button>
              </div>
            );
          };
          
          if (!isAuthReady) {
            return (
              <div className="loading-container">
                <Loader2 className="loader-icon" />
                <p className="loader-text">Initializing Auracast Health Services...</p>
              </div>
            );
          }

          // Use simplified icon components for the actual rendering
          const CurrentAlertIcon = ({ type }) => {
            switch (type) {
                case 'warning': return <AlertTriangle className="text-white" style={{ width: '1.5rem', height: '1.5rem' }} />;
                default: return <HeartPulse className="text-white" style={{ width: '1.5rem', height: '1.5rem' }} />;
            }
          };

          return (
            <div className="min-h-screen app-container" style={{ backgroundColor: '#f9fafb' /* bg-gray-50 */ }}>
              
              {/* Personalized Health Alerts (Simulated Push Notifications) */}
              <HealthAlert 
                message={alertMessage} 
                onClose={() => setAlertMessage(null)} 
              />

              <header className="header-main flex justify-between items-center">
                <h1 className="header-title flex items-center">
                  <HeartPulse className="header-icon" />
                  Auracast Health Hub
                </h1>
                <div className="header-user-id flex items-center">
                    <User className="mr-1" style={{ width: '1rem', height: '1rem' }}/>
                    User ID: <span className="ml-1">{userId}</span>
                </div>
              </header>


              <main className="main-grid">

                {/* Column 1: Symptom Tracker & History */}
                <section className="lg-col-span-2">
                  
                  {/* Health Symptom Tracker Form */}
                  <div className="card-base card-tracker">
                    <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center" style={{ fontSize: '1.25rem', color: '#1f2937' }}>
                      <AirVent className="mr-2" style={{ width: '1.25rem', height: '1.25rem', color: '#10b981' }} />
                      🩺 Health Symptom Tracker (Log)
                    </h2>
                    
                    <form onSubmit={addSymptom} className="form-section" style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                      
                      {/* Symptom Type and Severity */}
                      <div className="grid-cols-2">
                        <div>
                          <label htmlFor="type" className="form-label">Symptom <span style={{color: 'red'}}>*</span></label>
                          <select
                            id="type"
                            name="type"
                            value={newSymptomData.type}
                            onChange={handleSymptomChange}
                            className="input-field"
                          >
                            {SYMPTOM_OPTIONS.map(s => (
                              <option key={s} value={s}>{s}</option>
                            ))}
                          </select>
                        </div>
                        <div>
                          <label htmlFor="severity" className="form-label">Severity (1-5) <span style={{color: 'red'}}>*</span></label>
                          <input
                            id="severity"
                            name="severity"
                            type="number"
                            min="1"
                            max="5"
                            value={newSymptomData.severity}
                            onChange={handleSymptomChange}
                            className="input-field"
                            required
                          />
                        </div>
                      </div>

                      {/* Conditional input for 'Other' symptom */}
                      {newSymptomData.type === 'Other' && (
                        <div>
                          <label htmlFor="otherSymptom" className="form-label">Specific Symptom Name <span style={{color: 'red'}}>*</span></label>
                          <input
                            id="otherSymptom"
                            name="otherSymptom"
                            type="text"
                            value={newSymptomData.otherSymptom}
                            onChange={handleSymptomChange}
                            placeholder="e.g., Joint pain, Hives, etc."
                            className="input-field"
                            required
                          />
                        </div>
                      )}


                      {/* Duration and Notes */}
                      <div>
                          <label htmlFor="duration" className="form-label">Duration (e.g., "30 seconds", "2 hours", "All day") <span style={{color: 'red'}}>*</span></label>
                          <input
                            id="duration"
                            name="duration"
                            type="text"
                            value={newSymptomData.duration}
                            onChange={handleSymptomChange}
                            placeholder="e.g., '60 seconds', '1 hour', 'Intermittent'"
                            className="input-field"
                            required
                          />
                      </div>

                      <div>
                          <label htmlFor="notes" className="form-label">Notes (Optional)</label>
                          <textarea
                            id="notes"
                            name="notes"
                            rows="2"
                            value={newSymptomData.notes}
                            onChange={handleSymptomChange}
                            placeholder="Specific time, location, or medication taken..."
                            className="input-field"
                          ></textarea>
                      </div>

                      <button
                        type="submit"
                        disabled={!isAuthReady || !newSymptomData.type}
                        className="btn-primary"
                      >
                        Log Symptom & Link to Environmental Context
                      </button>
                    </form>

                    <h3 className="text-lg font-medium text-gray-700 mt-8 mb-3 border-b pb-2" style={{ marginTop: '2rem', marginBottom: '0.75rem', borderBottom: '1px solid #e5e7eb', paddingBottom: '0.5rem', fontSize: '1.125rem', fontWeight: '500', color: '#374151' }}>Recent History</h3>
                    {symptoms.length === 0 ? (
                        <p style={{ color: '#6b7280', fontStyle: 'italic' }}>No symptoms logged yet. Start tracking to build your personal exposure history.</p>
                    ) : (
                        <ul className="history-list">
                        {symptoms.map((symptom) => (
                            <li key={symptom.id} className="history-item">
                                <div className="history-header flex justify-between items-start">
                                    <p className="history-type flex items-center">
                                        {symptom.type} 
                                        <span className='history-severity'>
                                            Severity: {symptom.severity}
                                        </span>
                                    </p>
                                    <p style={{ fontSize: '0.75rem', color: '#6b7280', marginTop: '0.125rem' }}>{symptom.timestamp}</p>
                                </div>
                                {symptom.duration && <p style={{ fontSize: '0.75rem', color: '#4b5563', marginBottom: '0.25rem' }}>Duration: {symptom.duration}</p>}
                                {symptom.notes && <p style={{ fontSize: '0.75rem', fontStyle: 'italic', color: '#6b7280', marginBottom: '0.25rem', borderTop: '1px solid #f3f4f6', paddingTop: '0.25rem', marginTop: '0.25rem' }}>Notes: {symptom.notes}</p>}
                                
                                <div className="history-context">
                                   * Context: <span style={{ fontWeight: '600' }}>{symptom.exposureData.aqiText} (AQI {symptom.exposureData.aqiValue})</span>
                                </div>
                            </li>
                        ))}
                        </ul>
                    )}
                  </div>
                </section>


                {/* Column 2: Analytics */}
                <section>
                  
                  {/* Environmental Context Header (Now static location) */}
                  <div className={`status-card-base ${healthStatus.colorClass}`}>
                      <h2 className="status-card-header flex items-center">
                        <CurrentAlertIcon type={healthStatus.aqiText.includes("Unhealthy") ? 'warning' : 'info'} />
                        <span style={{ marginLeft: '0.5rem' }}>Local Air Quality Status</span>
                      </h2>
                      {/* Location added to the main status card */}
                      <p className="status-card-text" style={{ fontWeight: '600', marginBottom: '0.25rem' }}>Location: {healthStatus.location}</p> 

                      <p className="status-card-text">AQI: {healthStatus.aqiValue} ({healthStatus.aqiText}) | {healthStatus.healthRisk}</p>
                  </div>

                  {/* Analytics & Smart Insights */}
                  <div className="card-base card-analytics">
                    <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center" style={{ fontSize: '1.25rem', color: '#1f2937' }}>
                      <BarChart3 className="mr-2" style={{ width: '1.25rem', height: '1.25rem', color: '#9333ea' }} />
                      📊 Analytics & Smart Insights
                    </h2>
                    
                    <div className="analytics-insight">
                        <p className="analytics-title">Smart Insight:</p>
                        {/* Helper function to render bolded text from mock story (simplified) */}
                        <p className="analytics-text" dangerouslySetInnerHTML={{ __html: getSmartInsight(symptoms, healthStatus).replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') }} />
                    </div>

                    <h3 style={{ fontSize: '1.125rem', fontWeight: '500', color: '#374151', marginBottom: '0.75rem' }}>Today's Environmental Data</h3>
                    
                    {/* Location detail added under the Environmental Data heading */}
                    <div style={{ fontSize: '1rem', fontWeight: '600', color: '#4f46e5', marginBottom: '0.75rem', borderBottom: '1px dashed #e5e7eb', paddingBottom: '0.5rem' }}>
                      📍 Location: {healthStatus.location}
                    </div>

                    <ul className="analytics-list">
                        <li><strong>Primary Pollutant:</strong> {healthStatus.primaryPollutant}</li>
                        <li><strong>PM2.5:</strong> {healthStatus.pollutants['PM2.5']} µg/m³</li>
                        <li><strong>NO2:</strong> {healthStatus.pollutants['NO2']} ppm</li>
                        <li><strong>Weather/Pollen:</strong> {healthStatus.weather.temp}, {healthStatus.weather.wind} (Pollen: {healthStatus.weather.pollenIndex})</li>
                    </ul>

                    {/* Medical Disclaimer */}
                    <div className="disclaimer">
                        <p className="disclaimer-title flex items-center">
                            <AlertTriangle className="mr-1" style={{ width: '1rem', height: '1rem' }}/>
                            Medical Disclaimer
                        </p>
                        <p className="disclaimer-text">
                            Auracast is not a substitute for professional medical diagnosis or advice. Always consult a healthcare provider for any health concerns.
                        </p>
                    </div>
                  </div>
                </section>
              </main>

              {/* Added Description Section at the end of the page */}
              <div className="about-section">
                  <h2 className="about-title">About the Auracast Health Hub</h2>
                  <p className="about-description">
                      The Auracast Health Hub is a personal environmental health tracker designed to help you connect your daily symptoms with real-time local air quality (AQI) and weather data. 
                      By logging symptoms with severity and duration, the system provides automated insights and identifies correlations between your health and atmospheric conditions, especially regarding pollutants like <strong>PM2.5</strong> and <strong>Ozone</strong>, and local <strong>pollen levels</strong>. 
                      It acts as a proactive tool for managing environmentally-triggered respiratory and allergic conditions by helping you recognize your personal triggers.
                  </p>
              </div>

            </div>
          );
        };

        // Render the App component into the root element
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
