<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auracast - Integrated Map Interface</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />   
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    
    <style>
        /* FONT & BASIC RESET */
        
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            overflow: hidden;
        }

    .header {
        text-align: center;
        padding: 20px;
        background-color: #f8f9fa;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .my-button {
        background-color: transparent;
        border-color: transparent;
    /* px-4 py-2 */
   .my-button {
    background-color: transparent;
    border-color: transparent;
    padding: 0.5rem 1rem; 
    margin-top: 8px;
    
    /* rounded-full */
    border-radius: 9999px;

    /* text-slate-600 */
    color: #475569;

    /* font-medium */
  
    font-weight: bold;
    
    /* transition-colors */
   
    transition-property: color, background-color;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
    cursor: pointer;
    }

    /* hover:text-indigo-600 hover:bg-black/5 */
    .my-button:hover {
    color: #4f46e5;
    background-color: rgba(0, 0, 0, 0.05);
    }


        /* BREEZE ANIMATION */
        @keyframes breeze {
            0% { transform: translateX(-100%) translateY(-50%) rotate(-20deg); opacity: 0; }
            20%, 80% { opacity: 0.08; }
            100% { transform: translateX(100%) translateY(50%) rotate(20deg); opacity: 0; }
        }
        .controls-sidebar::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to right, transparent, #e0f2f1, transparent);
            z-index: -1;
            animation: breeze 12s ease-in-out infinite;
            animation-delay: -6s;
        }


        /* APP LAYOUT STRUCTURE */
        
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* MAP CONTAINER (LEFT) */
        .map-container {
            flex: 1; /* Takes up remaining space */
            position: relative;
        }
        #map {
            width: 100%;
            height: 100%;
        }

        /* CONTROLS SIDEBAR (RIGHT) */
        .controls-sidebar {
            width: 380px;
            background: white;
            padding: 1.5rem;
            overflow-y: auto;
            box-shadow: -4px 0 15px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            position: relative; /* For breeze animation */
            flex-direction: column;
        }
        
        .sidebar-header {
            margin-bottom: 2rem;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 1rem;
        }
        .sidebar-header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #2c3e50;
        }
        .sidebar-header p {
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* FORM CONTROL STYLES */
        .control-group {
            margin-bottom: 1.25rem;
        }
        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            color: #2c3e50;
        }
        .control-group input[type="text"], .control-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        .control-group input[type="text"]:focus, .control-group select:focus, .control-group input[type="range"]:focus {
            outline: none;
            border-color: #27ae60;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        .checkbox-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .checkbox-group input {
            margin-right: 0.5rem;
        }
        
        /* BUTTONS */
        .action-btn {
            width: 100%;
            background: linear-gradient(135deg, #009688, #00796b);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .action-btn:hover, .action-btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        .action-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* UTILITY */
        #location-details {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #009688;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }
        .slider {
            width: 100%;
            cursor: pointer;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* RESPONSIVE DESIGN */
        @media (max-width: 800px) {
            .app-container { flex-direction: column-reverse; }
            .controls-sidebar { width: 100%; max-height: 50vh; }
        }
    </style>
</head>
<body>

    <header class="header">
        <h1>Auracast - Route Planner</h1>
        <p>Find the safest route based on air quality data</p>
        <div class="my-buttons">
            <a href="../index.html"><button class="my-button">HOME</button></a>
            <a href="../map/mainmap.html"><button class="my-button">MAP</button></a>
            <a href="../community/aura_community.html"><button class="my-button">COMMUNITY</button></a>
            <a href="../symptomTracker/symptom.html"><button class="my-button">SYMPTOM TRACKER</button></a>
            
        </div>
    </header>

    <div class="app-container">
        
        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="controls-sidebar">
            <div class="sidebar-header">
                <h1>Air-Safe Planner</h1>
                <p>Environmental data visualization</p>
            </div>
            
            <div class="control-group">
                <label for="start-location">Start Location</label>
                <input type="text" id="start-location" placeholder="Enter an address or city...">
            </div>

            <div class="control-group">
                <label for="end-location">End Location</label>
                <input type="text" id="end-location" placeholder="Enter destination...">
            </div>
            <div class="control-group">
                <label for="travel-mode">Travel Mode</label>
                <select id="travel-mode">
                    <option value="driving">Driving</option>
                    <option value="walking">Walking</option>
                    <option value="cycling">Cycling</option>
                </select>
            </div>
            <div class="control-group">
                <label for="exposure-preference">Exposure Preference (Visual Only)</label>
                <select id="exposure-preference">
                    <option value="balanced">Balanced (Time + Safety)</option>
                    <option value="safest">Safest Route</option>
                </select>
            </div>

            <button id="calculate-route-btn" class="action-btn">Calculate Route</button>
            <div id="location-details">Enter start and end points to calculate a route.</div>

            <div class="control-group" style="margin-top: 2rem; border-top: 1px solid #e9ecef; padding-top: 1.5rem;">
                <label for="opacity-slider">Heatmap Opacity</label>
                <input type="range" min="0" max="100" value="70" class="slider" id="opacity-slider">
            </div>
        </div>
        
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <script>
        const appData = {
            airQuality: [[34.05,-118.24,155],[34.15,-118.44,120],[33.94,-118.4,110],[34.02,-118.49,45],[34.2,-118.55,130],[33.77,-118.19,90],[34.14,-118.14,160],[34.06,-118.02,175],[33.83,-118.35,60],[34.28,-118.79,30],[33.95,-118.23,165],[37.77,-122.41,80],[37.33,-121.88,95],[37.8,-122.27,105],[38.58,-121.49,130],[36.73,-119.78,160],[35.37,-119.01,170],[32.71,-117.16,60],[36.17,-115.14,110],[33.44,-112.07,140],[39.52,-119.81,55],[28.61,77.23,250],[19.07,72.87,180],[12.97,77.59,160],[22.57,88.36,190],[13.08,80.27,170],[51.5,-0.12,70],[48.85,2.35,85],[52.52,13.4,90],[41.9,12.49,110],[40.41,-3.7,75],[55.75,37.61,120],[47.49,19.04,130],[35.68,139.69,100],[39.9,116.4,220],[31.23,121.47,190],[37.56,126.97,140],[-34.6,-58.38,95],[-23.55,-46.63,150],[-12.04,-77.04,135],[4.71,-74.07,160],[30.04,31.23,200],[6.52,3.37,180],[-26.2,28.04,140],[-1.29,36.82,110],[-33.86,151.2,50],[-37.81,144.96,65],[-36.84,174.76,40],[25.2,55.27,210],[24.71,46.67,230],[19.43,-99.13,185],[43.65,-79.38,80],[41.87,-87.62,115],[29.76,-95.36,125],[-22.9,-43.17,130],[-33.44,-70.66,145],[41,28.97,140],[50.45,30.52,125],[52.36,4.89,65],[13.75,100.5,195],[-6.2,106.84,205],[24.86,67,215],[35.68,51.38,240]],
            dustStorms: [{coords:[[33.8,-118],[33.9,-117.8],[33.7,-117.7],[33.6,-117.9]],msg:"Dust storm warning in SoCal."},{coords:[[33.2,-112.5],[33.8,-112.4],[33.7,-111.5],[33.1,-111.6]],msg:"Monsoon dust storm near Phoenix."},{coords:[[26.5,72],[28,73.5],[27.5,75],[26,74]],msg:"Pre-monsoon dust activity in the Thar Desert region."},{coords:[[30,28],[31.5,29],[30.5,30.5],[29,29.5]],msg:"Saharan dust plume moving over Egypt."},{coords:[[40,85],[41.5,86],[40.5,87.5],[39,86.5]],msg:"Dust from the Taklamakan Desert, China."},{coords:[[-25,133],[-23.5,134],[-24.5,135.5],[-26,134.5]],msg:"Dust storm in the Australian Outback."}],
            pollenHotspots: [{lat:34.18,lon:-118.3,msg:"High Tree Pollen Zone (Burbank)"},{lat:38.6,lon:-121.45,msg:"High Weed Pollen Zone (Sacramento)"},{lat:28.61,lon:77.23,msg:"High Parthenium Pollen Zone (Delhi)"},{lat:12.97,lon:77.59,msg:"High Grass & Weed Pollen (Bangalore)"},{lat:30.26,lon:-97.74,msg:"High Cedar Pollen (Austin, TX)"},{lat:37.88,lon:-4.77,msg:"High Olive Tree Pollen (CÃ³rdoba, Spain)"},{lat:35.68,lon:139.69,msg:"High Cedar/Cypress Pollen (Tokyo, Japan)"},{lat:33.68,lon:73.04,msg:"Very High Paper Mulberry Pollen (Islamabad, Pakistan)"}]
        };

        document.addEventListener('DOMContentLoaded', function () {
            const map = L.map('map').setView([20, 0], 2.5);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap &copy; CARTO', maxZoom: 20
            }).addTo(map);

            const heatLayer = L.heatLayer(appData.airQuality, { radius: 35, blur: 20, maxZoom: 12, gradient: {0.1:'blue',0.3:'lime',0.5:'yellow',0.7:'orange',1.0:'red'} });
            const dustLayer = L.layerGroup(appData.dustStorms.map(s => L.polygon(s.coords, {color:'orange',fillColor:'#DAA520',fillOpacity:0.3,weight:1}).bindPopup(`<b>Alert:</b> ${s.msg}`)));
            const pollenLayer = L.layerGroup(appData.pollenHotspots.map(h => L.circle([h.lat,h.lon], {radius:40000,color:'green',fillColor:'#90EE90',fillOpacity:0.5}).bindPopup(h.msg)));
            const overlayMaps = {"ðŸ”¥ Air Quality Heatmap": heatLayer, "ðŸ’¨ Dust Storms": dustLayer, "ðŸŒ¿ Pollen Hotspots": pollenLayer};
            L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);
            heatLayer.addTo(map); dustLayer.addTo(map); pollenLayer.addTo(map);

            const startInput = document.getElementById('start-location');
            const endInput = document.getElementById('end-location');
            const travelModeSelect = document.getElementById('travel-mode');
            const calculateBtn = document.getElementById('calculate-route-btn');
            const detailsPanel = document.getElementById('location-details');
            const slider = document.getElementById('opacity-slider');
            
            let routingControl = null;
            let startMarker = null;
            let endMarker = null;

            async function geocode(query) {
                const url = `https://nominatim.openstreetmap.org/search?format=json&limit=1&q=${encodeURIComponent(query)}`;
                try {
                    const resp = await fetch(url, { headers: { 'Accept-Language': 'en' } });
                    if (!resp.ok) throw new Error('Geocode request failed');
                    const data = await resp.json();
                    if (!data || data.length === 0) return null;
                    const item = data[0];
                    return L.latLng(parseFloat(item.lat), parseFloat(item.lon));
                } catch (err) {
                    console.error('Geocode error', err);
                    return null;
                }
            }

            const calculateRoute = async () => {
                const startQuery = startInput.value;
                const endQuery = endInput.value;
                const travelMode = travelModeSelect.value;

                if (!startQuery || !endQuery) {
                    detailsPanel.innerHTML = 'Please enter both a start and end location.';
                    return;
                }

                calculateBtn.disabled = true;
                detailsPanel.innerHTML = '<div class="loader"></div><span>Calculating route...</span>';

                if (routingControl) map.removeControl(routingControl);
                if (startMarker) map.removeLayer(startMarker);
                if (endMarker) map.removeLayer(endMarker);

                const [startLatLng, endLatLng] = await Promise.all([geocode(startQuery), geocode(endQuery)]);

                if (!startLatLng || !endLatLng) {
                    detailsPanel.innerHTML = '<b>Error:</b> Could not find one or both locations. Please try a more specific address.';
                    calculateBtn.disabled = false;
                    return;
                }

                routingControl = L.Routing.control({
                    waypoints: [ startLatLng, endLatLng ],
                    router: L.Routing.osrmv1({
                        serviceUrl: `https://router.project-osrm.org/route/v1`,
                        profile: travelMode // OSRM uses 'driving', 'walking', 'cycling'
                    }),
                    lineOptions: {
                        styles: [{ color: '#009688', opacity: 0.8, weight: 6 }]
                    },
                    addWaypoints: false,
                    createMarker: () => null,
                    show: false,
                    routeWhileDragging: false
                }).addTo(map);

                routingControl.on('routesfound', function(e) {
                    const route = e.routes[0];
                    startMarker = L.circleMarker(startLatLng, { radius: 8, color: 'white', fillColor: '#27ae60', fillOpacity: 1, weight: 2 }).addTo(map);
                    endMarker = L.circleMarker(endLatLng, { radius: 8, color: 'white', fillColor: '#c0392b', fillOpacity: 1, weight: 2 }).addTo(map);

                    if (route && route.bounds) map.fitBounds(route.bounds);

                    detailsPanel.innerHTML = `<b>Route Found!</b><br>Distance: ${(route.summary.totalDistance / 1000).toFixed(1)} km<br>Time: ${Math.round(route.summary.totalTime / 60)} mins`;
                    calculateBtn.disabled = false;
                });

                routingControl.on('routingerror', function(e) {
                    console.error("Routing Error:", e);
                    detailsPanel.innerHTML = `<b>Error:</b> Could not find a route between these locations. The OSRM demo server might be down.`;
                    calculateBtn.disabled = false;
                });
            };

            calculateBtn.addEventListener('click', calculateRoute);
            startInput.addEventListener('keypress', (e) => e.key === 'Enter' && calculateRoute());
            endInput.addEventListener('keypress', (e) => e.key === 'Enter' && calculateRoute());

            // **FIXED**: Use setOptions for the opacity slider
            slider.addEventListener('input', (e) => {
                heatLayer.setOptions({ opacity: parseInt(e.target.value) / 100 });
            });
            // 
            heatLayer.setOptions({ opacity: parseInt(slider.value) / 100 });
        });
    </script>

</body>
</html>
